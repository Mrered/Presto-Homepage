import{d as u,N as w,g as p,b as l}from"./DkUshctD.js";const r="";function h(){return typeof document>"u"?"":document.querySelector('meta[name="api-key"]')?.getAttribute("content")||""}function s(a,e){const t=h();if(t){const o=new Headers(e?.headers);return o.set("Authorization",`Bearer ${t}`),fetch(a,{...e,headers:o})}return fetch(a,e)}async function y(a,e){const t=await s(`${r}${a}`,e);if(!t.ok)throw new Error(`API error: ${t.status}`);return t.json()}async function $(){return y("/api/templates")}async function E(a){return(await y(`/api/templates/${a}/example`)).example}async function S(a,e){const t=await s(`${r}/api/convert`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdown:a,templateId:e})});if(!t.ok){const n=await t.text();throw new Error(`Convert failed (${t.status}): ${n}`)}return(await t.json()).typst}async function j(a,e){const t={"Content-Type":"text/plain"};e&&(t["X-Work-Dir"]=e);const o=e?`${r}/api/compile-svg?workDir=${encodeURIComponent(e)}`:`${r}/api/compile-svg`,n=await s(o,{method:"POST",headers:t,body:a});if(!n.ok){const c=await n.text();throw new Error(`SVG compile failed (${n.status}): ${c}`)}return(await n.json()).pages}async function C(a,e,t){const o=await s(`${r}/api/convert-and-compile`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdown:a,templateId:e,workDir:t})});if(!o.ok){const n=await o.text();throw new Error(`Compile failed (${o.status}): ${n}`)}return o.blob()}async function T(a,e,t){const o=await s(`${r}/api/templates/${encodeURIComponent(a+"/"+e)}/install`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner:a,repo:e,platforms:t})});if(!o.ok)throw new Error(`Install failed: ${o.status}`)}function P(a){let e,t;if(a.repo){const o=a.repo.split("/");e=o[0],t=o[1]}else if(a.repository){const n=new URL(a.repository).pathname.slice(1).split("/");e=n[0],t=n[1]}else return Promise.reject(new Error("No repository info"));return T(e,t,a.platforms)}async function k(a){const e=await s(`${r}/api/templates/${a}`,{method:"DELETE"});if(!e.ok)throw new Error(`Delete failed: ${e.status}`)}async function O(a,e){const t=await s(`${r}/api/templates/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:e})});if(!t.ok){const o=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(o.error||`Rename failed: ${t.status}`)}}async function v(a,e){const t=new FormData;t.append("file",a);const o=e?`?onConflict=${e}`:"",n=await s(`${r}/api/templates/import${o}`,{method:"POST",body:t});if(n.status===409){const i=await n.json(),c=new Error(i.error||"conflict");throw c.conflicts=i.conflicts,c}if(!n.ok){const i=await n.json().catch(()=>({error:`HTTP ${n.status}`}));throw new Error(i.error||`Import failed: ${n.status}`)}return n.json()}async function x(a){const e=new FormData;e.append("file",a);const t=await s(`${r}/api/batch/import-zip`,{method:"POST",body:e});if(!t.ok){const o=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(o.error||`Batch import failed: ${t.status}`)}return t.json()}let m=u(w([])),d=u(!1),f=u(!1);const g={get templates(){return p(m)},get loading(){return p(d)},get loaded(){return p(f)},async load(a=!1){if(!(p(f)&&!a)){l(d,!0);try{l(m,await $()??[],!0)}catch{}finally{l(d,!1),l(f,!0)}}},async refresh(){return this.load(!0)}};typeof window<"u"&&window.addEventListener("templates-changed",()=>{g.refresh()});export{x as a,j as b,S as c,C as d,v as e,k as f,E as g,P as i,$ as l,O as r,g as t};
