import{d as u,e as w,g as p,b as l}from"./D1kjAdh8.js";const r="";function h(){return typeof document>"u"?"":document.querySelector('meta[name="api-key"]')?.getAttribute("content")||""}function s(e,a){const t=h();if(t){const o=new Headers(a?.headers);return o.set("Authorization",`Bearer ${t}`),fetch(e,{...a,headers:o})}return fetch(e,a)}async function y(e,a){const t=await s(`${r}${e}`,a);if(!t.ok)throw new Error(`API error: ${t.status}`);return t.json()}async function $(){return y("/api/templates")}async function E(e){return(await y(`/api/templates/${e}/example`)).example}async function S(e,a){const t=await s(`${r}/api/convert`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdown:e,templateId:a})});if(!t.ok){const n=await t.text();throw new Error(`Convert failed (${t.status}): ${n}`)}return(await t.json()).typst}async function j(e,a){const t={"Content-Type":"text/plain"};a&&(t["X-Work-Dir"]=a);const o=a?`${r}/api/compile-svg?workDir=${encodeURIComponent(a)}`:`${r}/api/compile-svg`,n=await s(o,{method:"POST",headers:t,body:e});if(!n.ok){const c=await n.text();throw new Error(`SVG compile failed (${n.status}): ${c}`)}return(await n.json()).pages}async function C(e,a,t){const o=await s(`${r}/api/convert-and-compile`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdown:e,templateId:a,workDir:t})});if(!o.ok){const n=await o.text();throw new Error(`Compile failed (${o.status}): ${n}`)}return o.blob()}async function T(e,a,t,o){const n=await s(`${r}/api/templates/${encodeURIComponent(e+"/"+a)}/install`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner:e,repo:a,platforms:t,trust:o})});if(!n.ok)throw new Error(`Install failed: ${n.status}`)}function P(e){let a,t;if(e.repo){const o=e.repo.split("/");a=o[0],t=o[1]}else if(e.repository){const n=new URL(e.repository).pathname.slice(1).split("/");a=n[0],t=n[1]}else return Promise.reject(new Error("No repository info"));return T(a,t,e.platforms,e.trust)}async function k(e){const a=await s(`${r}/api/templates/${e}`,{method:"DELETE"});if(!a.ok)throw new Error(`Delete failed: ${a.status}`)}async function O(e,a){const t=await s(`${r}/api/templates/${encodeURIComponent(e)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:a})});if(!t.ok){const o=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(o.error||`Rename failed: ${t.status}`)}}async function v(e,a){const t=new FormData;t.append("file",e);const o=a?`?onConflict=${a}`:"",n=await s(`${r}/api/templates/import${o}`,{method:"POST",body:t});if(n.status===409){const i=await n.json(),c=new Error(i.error||"conflict");throw c.conflicts=i.conflicts,c}if(!n.ok){const i=await n.json().catch(()=>({error:`HTTP ${n.status}`}));throw new Error(i.error||`Import failed: ${n.status}`)}return n.json()}async function x(e){const a=new FormData;a.append("file",e);const t=await s(`${r}/api/batch/import-zip`,{method:"POST",body:a});if(!t.ok){const o=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(o.error||`Batch import failed: ${t.status}`)}return t.json()}let m=u(w([])),d=u(!1),f=u(!1);const g={get templates(){return p(m)},get loading(){return p(d)},get loaded(){return p(f)},async load(e=!1){if(!(p(f)&&!e)){l(d,!0);try{l(m,await $()??[],!0)}catch{}finally{l(d,!1),l(f,!0)}}},async refresh(){return this.load(!0)}};typeof window<"u"&&window.addEventListener("templates-changed",()=>{g.refresh()});export{x as a,j as b,S as c,C as d,v as e,k as f,E as g,P as i,$ as l,O as r,g as t};
