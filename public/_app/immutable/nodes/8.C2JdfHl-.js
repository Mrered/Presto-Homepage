import{a as A,f as B}from"../chunks/DE3Q9Awg.js";import{a as Te}from"../chunks/CJTN17t5.js";import{p as De,d as l,N as Ee,P as Se,g as s,f as Fe,t as W,a as ze,u as Le,b as t,c as o,s as n,r as i,O as Ne}from"../chunks/DkUshctD.js";import{d as Ae,a as $,e as Z,s as ee}from"../chunks/Xh7j0qJd.js";import{i as M,a as Me,b as Be}from"../chunks/xO5lRXbR.js";import{a as te,c as se,b as Ie}from"../chunks/BBgSnbQe.js";import{b as ae}from"../chunks/sksWJ-dI.js";import{p as Ce}from"../chunks/BXY3fFrd.js";import{E as Oe,p as Xe}from"../chunks/Dypf2YIG.js";import{P as Ye}from"../chunks/z_z3yBiK.js";import{j as Ge,g as Ue}from"../chunks/DAo8eZNg.js";import{g as Ve}from"../chunks/Bm8zFn3A.js";import{g as qe}from"../chunks/DrTtjm8K.js";import{j as He}from"../chunks/D6u2LCMp.js";import{S as Je}from"../chunks/dzH4J3Rn.js";import{F as Ke,L as Qe}from"../chunks/C0UVGYz6.js";import{D as We}from"../chunks/C9orDFqI.js";import{L as Ze}from"../chunks/T-nkeejB.js";var et=B('<div class="status-dot svelte-j6xk7s"></div>'),tt=B('<span class="error-msg svelte-j6xk7s"> </span>'),st=B('<div class="toolbar svelte-j6xk7s"><div class="toolbar-left svelte-j6xk7s"><span class="template-name svelte-j6xk7s"><!> </span> <!></div> <div class="toolbar-right svelte-j6xk7s"><!> <div><button class="btn-toolbar svelte-j6xk7s" aria-label="设置"><!></button> <button class="btn-toolbar svelte-j6xk7s" aria-label="打开文件"><!></button> <button class="btn-toolbar svelte-j6xk7s" aria-label="批量转换"><!></button></div> <button class="btn-export svelte-j6xk7s" aria-label="导出 PDF"><!> <span class="svelte-j6xk7s">导出 PDF</span></button></div></div> <div><div class="pane svelte-j6xk7s"><!></div> <div class="divider svelte-j6xk7s" role="separator" aria-label="拖动调整宽度" aria-orientation="vertical"><div class="divider-grip svelte-j6xk7s"><span class="svelte-j6xk7s"></span><span class="svelte-j6xk7s"></span><span class="svelte-j6xk7s"></span></div></div> <div class="pane svelte-j6xk7s"><!></div></div>',1);function jt(re,oe){De(oe,!0);const ie=()=>Be(Ce,"$page",le),[le,ne]=Me(),ve={gongwen:{example:Ue,svgs:[Ve,qe],displayName:"类公文模板"},"jiaoan-shicao":{example:Ge,svgs:[He],displayName:"实操教案模板"}};let I=Le(()=>ie().url.searchParams.get("registry")||"gongwen"),b=l(""),_=l(Ee([])),c=l(""),m=l(!1),d=l("");const T="https://raw.githubusercontent.com/Presto-io/template-registry/main/templates";async function pe(e){t(m,!0),t(d,"");const a=ve[e];if(a){t(b,a.example,!0),t(_,a.svgs,!0),t(c,a.displayName,!0),t(m,!1);return}try{const[r,N]=await Promise.all([fetch(`${T}/${e}/example.md`),fetch(`${T}/${e}/manifest.json`)]);if(!r.ok)throw new Error(`模板 "${e}" 未找到`);if(t(b,await r.text(),!0),N.ok){const u=await N.json();t(c,u.displayName||u.name||e,!0)}else t(c,e,!0);const K=[];for(let u=1;u<=5;u++)try{const Q=await fetch(`${T}/${e}/preview-${u}.svg`);if(!Q.ok)break;const $e=await Q.text();K.push(Xe.sanitize($e,{USE_PROFILES:{svg:!0,svgFilters:!0},ADD_TAGS:["use"],ADD_ATTR:["xlink:href","clip-path","fill-rule","transform"]}))}catch{break}t(_,K,!0)}catch(r){t(d,r instanceof Error?r.message:String(r),!0),t(b,""),t(_,[],!0),t(c,e,!0)}finally{t(m,!1)}}Se(()=>{pe(s(I))});let C=l(0),O=l(0),v=l(null),D=l(.5),x=l(!1),h,j,f=l(!1),p;function X(){clearTimeout(p),t(f,!0)}function ue(){clearTimeout(p),p=setTimeout(()=>{t(f,!1)},800)}function ce(e){if(!j)return;const a=j.getBoundingClientRect(),r=60;e.clientX>=a.left-r&&e.clientX<=a.right+r&&e.clientY>=a.top-r&&e.clientY<=a.bottom+r?X():s(f)&&(clearTimeout(p),p=setTimeout(()=>{t(f,!1)},800))}Te(()=>{clearTimeout(p)});function me(e){t(x,!0),e.target.setPointerCapture(e.pointerId)}function de(e){if(!s(x)||!h)return;const a=h.getBoundingClientRect(),r=(e.clientX-a.left)/a.width;t(D,Math.min(.8,Math.max(.2,r)),!0)}function fe(){t(x,!1)}var Y=st(),k=Fe(Y),E=o(k),S=o(E),G=o(S);{var ge=e=>{Ze(e,{size:12,class:"spin"})};M(G,e=>{s(m)&&e(ge)})}var be=n(G);i(S);var _e=n(S,2);{var xe=e=>{var a=et();A(e,a)};M(_e,e=>{s(m)&&e(xe)})}i(E);var g=n(E,2),U=o(g);{var he=e=>{var a=tt(),r=o(a,!0);i(a),W(()=>{Ie(a,"title",s(d)),ee(r,s(d))}),A(e,a)};M(U,e=>{s(d)&&e(he)})}var w=n(U,2);let V;var F=o(w),je=o(F);Je(je,{size:14}),i(F);var z=n(F,2),ke=o(z);Ke(ke,{size:14}),i(z);var q=n(z,2),we=o(q);Qe(we,{size:14}),i(q),i(w);var H=n(w,2),ye=o(H);We(ye,{size:14}),Ne(2),i(H),i(g),ae(g,e=>j=e,()=>j),i(k);var y=n(k,2);let J;var R=o(y),Re=o(R);Oe(Re,{get value(){return s(b)},readOnly:!0,get scrollRatio(){return s(C)},onscroll:e=>{s(v)!=="preview"&&(t(v,"editor"),t(O,e,!0),setTimeout(()=>{t(v,null)},100))}}),i(R);var P=n(R,2),L=n(P,2),Pe=o(L);Ye(Pe,{get svgPages(){return s(_)},get scrollRatio(){return s(O)},onscroll:e=>{s(v)!=="editor"&&(t(v,"preview"),t(C,e,!0),setTimeout(()=>{t(v,null)},100))}}),i(L),i(y),ae(y,e=>h=e,()=>h),W(()=>{ee(be,` ${(s(c)||s(I))??""}`),V=te(w,1,"toolbar-hidden-group svelte-j6xk7s",null,V,{visible:s(f)}),J=te(y,1,"editor-layout svelte-j6xk7s",null,J,{dragging:s(x)}),se(R,`flex: ${s(D)??""}`),se(L,`flex: ${1-s(D)}`)}),$("mousemove",k,ce),Z("mouseenter",g,X),Z("mouseleave",g,ue),$("pointerdown",P,me),$("pointermove",P,de),$("pointerup",P,fe),A(re,Y),ze(),ne()}Ae(["mousemove","pointerdown","pointermove","pointerup"]);export{jt as component};
