import{c as Y,a as q,f as C}from"../chunks/C39mV9My.js";import{o as $}from"../chunks/BN5aVeYL.js";import{f as R,p as tt,d as H,e as lt,b as u,g as i,a as et,c as x,s as P,r as S,t as Q,u as U,H as dt,G as vt}from"../chunks/D1kjAdh8.js";import{d as nt,s as J,a as X}from"../chunks/Oi55ULqo.js";import{l as pt,s as ht,i as I,p as gt,a as bt,b as wt}from"../chunks/DHvLmY1O.js";import{s as yt}from"../chunks/-N3K3M2H.js";import{I as _t,s as kt,a as ct,c as ut}from"../chunks/ThjiEXdU.js";import{b as ft}from"../chunks/CQL5r_eC.js";import{p as Tt}from"../chunks/Z6hqIP1u.js";import{t as mt,f as xt,c as St,a as Et}from"../chunks/DYyef2Au.js";import{d as Dt,c as at,w as st,a as M,s as it,b as K,e as rt,f as V}from"../chunks/DElPTFiF.js";import"../chunks/BlPGaWXi.js";import{X as qt}from"../chunks/KBWIkVsW.js";import{f as N}from"../chunks/D49OYH7m.js";import{p as Mt}from"../chunks/BUIehYya.js";import{F as Pt}from"../chunks/BL--OL2S.js";const At=!0,Ft=!1,le=Object.freeze(Object.defineProperty({__proto__:null,prerender:At,ssr:Ft},Symbol.toStringTag,{value:"Module"}));function Lt(j,d){const y=pt(d,["children","$$slots","$$events","$$legacy"]);const l=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];_t(j,ht({name:"lightbulb"},()=>y,{get iconNode(){return l},children:(a,f)=>{var m=Y(),v=R(m);kt(v,d,"default",{}),q(a,m)},$$slots:{default:!0}}))}var zt=C('<div class="hint-shortcut svelte-1jumk7e"><kbd class="svelte-1jumk7e"> </kbd></div>'),Ot=C('<div role="tooltip" aria-live="polite"><div class="hint-header svelte-1jumk7e"><!> <span class="hint-title svelte-1jumk7e"> </span> <button class="hint-close svelte-1jumk7e" aria-label="关闭提示"><!></button></div> <p class="hint-body svelte-1jumk7e"> </p> <!> <button class="hint-dismiss svelte-1jumk7e">知道了</button></div>');function It(j,d){tt(d,!0);let y=H(void 0),l=H(lt({top:0,left:0})),a=H("top"),f=H(!1),m;function v(){const w=document.querySelector(d.point.anchorSelector);if(!w||!i(y))return;const r=w.getBoundingClientRect(),A=i(y).getBoundingClientRect(),e=A.width||280,n=A.height||120,t=12,g=window.innerWidth,b=window.innerHeight;let _=d.point.position;switch(_==="bottom"&&r.bottom+t+n>b&&(_="top"),_==="top"&&r.top-t-n<0&&(_="bottom"),_==="right"&&r.right+t+e>g&&(_="left"),_==="left"&&r.left-t-e<0&&(_="right"),_){case"bottom":u(l,{top:r.bottom+t,left:Math.max(8,Math.min(g-e-8,r.left+r.width/2-e/2))},!0),u(a,"top");break;case"top":u(l,{top:r.top-t-n,left:Math.max(8,Math.min(g-e-8,r.left+r.width/2-e/2))},!0),u(a,"bottom");break;case"right":u(l,{top:Math.max(8,Math.min(b-n-8,r.top+r.height/2-n/2)),left:r.right+t},!0),u(a,"left");break;case"left":u(l,{top:Math.max(8,Math.min(b-n-8,r.top+r.height/2-n/2)),left:r.left-t-e},!0),u(a,"right");break}}function E(){Dt(d.point.id),d.ondismiss?.()}function W(w){w.key==="Escape"&&E()}$(()=>{const w=setTimeout(()=>{u(f,!0),requestAnimationFrame(v)},50);function r(){i(f)&&v(),m=requestAnimationFrame(r)}return m=requestAnimationFrame(r),document.addEventListener("keydown",W),()=>{clearTimeout(w),cancelAnimationFrame(m),document.removeEventListener("keydown",W)}});const p=U(()=>({y:i(a)==="top"?-8:i(a)==="bottom"?8:0,x:i(a)==="left"?-8:i(a)==="right"?8:0,duration:300,easing:St}));var s=Y(),h=R(s);{var Z=w=>{var r=Ot();let A;var e=x(r),n=x(e);Lt(n,{size:14});var t=P(n,2),g=x(t,!0);S(t);var b=P(t,2),_=x(b);qt(_,{size:12}),S(b),S(e);var o=P(e,2),k=x(o,!0);S(o);var T=P(o,2);{var D=c=>{var F=zt(),z=x(F),O=x(z,!0);S(z),S(F),Q(()=>J(O,d.point.shortcut)),q(c,F)};I(T,c=>{d.point.shortcut&&c(D)})}var L=P(T,2);S(r),ft(r,c=>u(y,c),()=>i(y)),Q(()=>{A=ct(r,1,"wizard-hint svelte-1jumk7e",null,A,{"arrow-top":i(a)==="top","arrow-bottom":i(a)==="bottom","arrow-left":i(a)==="left","arrow-right":i(a)==="right"}),ut(r,`top: ${i(l).top??""}px; left: ${i(l).left??""}px`),J(g,d.point.title),J(k,d.point.body)}),X("click",b,E),X("click",L,E),mt(3,r,()=>xt,()=>i(p)),q(w,r)};I(h,w=>{i(f)&&w(Z)})}q(j,s),et()}nt(["click"]);var jt=C('<div class="wizard-nudge svelte-tnfk1q" role="button" tabindex="0" aria-label="提示可用，点击查看"><div class="nudge-dot svelte-tnfk1q"></div> <div class="nudge-ring svelte-tnfk1q"></div></div>');function Nt(j,d){tt(d,!0);let y=gt(d,"position",3,"right"),l=H(lt({top:0,left:0})),a=H(!1),f;function m(){const p=document.querySelector(d.anchorSelector);if(!p)return;const s=p.getBoundingClientRect(),h=12;switch(y()){case"top":u(l,{top:s.top-h,left:s.left+s.width/2},!0);break;case"bottom":u(l,{top:s.bottom+h,left:s.left+s.width/2},!0);break;case"left":u(l,{top:s.top+s.height/2,left:s.left-h},!0);break;case"right":u(l,{top:s.top+s.height/2,left:s.right+h},!0);break}}$(()=>{const p=setTimeout(()=>{u(a,!0),m()},100);function s(){i(a)&&m(),f=requestAnimationFrame(s)}return f=requestAnimationFrame(s),()=>{clearTimeout(p),cancelAnimationFrame(f)}});var v=Y(),E=R(v);{var W=p=>{var s=jt();Q(()=>ut(s,`top: ${i(l).top??""}px; left: ${i(l).left??""}px`)),X("click",s,function(...h){d.onactivate?.apply(this,h)}),X("keydown",s,h=>{h.key==="Enter"&&d.onactivate?.()}),mt(3,s,()=>Et,()=>({duration:400})),q(p,s)};I(E,p=>{i(a)&&p(W)})}q(j,v),et()}nt(["click","keydown"]);const B=[{id:"template-selector",trigger:"on-mount",anchorSelector:".template-select",position:"bottom",title:"选择模板",body:"在这里切换文档模板，不同模板适用于不同类型的文档。",route:"/",triggerDelay:1500},{id:"export-pdf",trigger:"on-mount",anchorSelector:".btn-export",position:"bottom",title:"导出 PDF",body:"编辑完成后，点击此按钮将文档导出为 PDF 文件。",shortcut:"⌘E",route:"/",triggerDelay:8e3},{id:"default-document",trigger:"on-mount",anchorSelector:".preview-container",position:"left",title:"模板示例",body:"右侧显示的是当前模板的示例文档。在左侧编辑器中输入你的 Markdown 内容，预览会实时更新。",route:"/",triggerDelay:15e3},{id:"shortcuts-overview",trigger:"on-mount",anchorSelector:".toolbar",position:"bottom",title:"常用快捷键",body:"熟悉这些快捷键可以大幅提升效率。",shortcut:"⌘O 打开 · ⌘E 导出 · ⌘F 查找 · ⌘Z 撤销",route:"/",triggerDelay:22e3},{id:"batch-mode",trigger:"on-idle",anchorSelector:".toolbar",position:"bottom",title:"批量转换",body:"需要一次转换多个文件？访问设置页面了解批量转换功能。",idleSeconds:120,route:"/"},{id:"image-path",trigger:"on-action",anchorSelector:".editor-container",position:"top",title:"图片路径",body:"使用 ![描述](路径) 插入图片。通过 ⌘O 打开文件后路径相对于文件目录，直接编辑时请使用绝对路径。",route:"/"},{id:"image-error",trigger:"on-action",anchorSelector:".error-msg",position:"bottom",title:"图片加载失败？",body:"请检查图片路径是否正确。通过 ⌘O 打开 .md 文件后，图片路径相对于文件所在目录；直接在编辑器中输入时，需要使用绝对路径。",route:"/"},{id:"settings-shortcut",trigger:"on-navigate",anchorSelector:".page-header",position:"bottom",title:"快速打开设置",body:"下次可以直接用快捷键打开设置页面。",shortcut:"⌘,",route:"/settings",triggerDelay:2e3},{id:"community-template-toggle",trigger:"on-action",anchorSelector:".nav-divider",position:"right",title:"模板管理已解锁",body:"侧栏新增了「模板管理」和「模板搜索」，点击即可浏览和安装第三方模板。",route:"/settings"}];var Ct=C("<!> <!>",1);function Wt(j,d){tt(d,!0);let y=[],l=new Map,a=new Map,f=H("");function m(){for(const e of y)clearTimeout(e);y=[];for(const e of l.values())clearTimeout(e);l.clear();for(const e of a.values())clearTimeout(e);a.clear()}function v(){if(M.id){const e=B.find(n=>n.id===M.id);if(e?.trigger==="on-idle"){M.id=null;const n=a.get(e.id);n&&(clearTimeout(n),a.delete(e.id))}}for(const[e,n]of l)clearTimeout(n),l.delete(e);E()}function E(){const e=i(f),n=B.filter(t=>t.trigger==="on-idle"&&t.route===e&&it(t.id));for(const t of n){if(l.has(t.id))continue;const g=setTimeout(()=>{if(l.delete(t.id),!document.querySelector(t.anchorSelector)||K.id||M.id)return;rt(t.id);const b=setTimeout(()=>{a.delete(t.id),M.id===t.id&&V(t.id)},3e3);a.set(t.id,b)},(t.idleSeconds??30)*1e3);l.set(t.id,g)}}function W(){const e=i(f),n=B.filter(t=>t.trigger==="on-mount"&&t.route===e&&it(t.id)).sort((t,g)=>(t.triggerDelay??0)-(g.triggerDelay??0));for(const t of n){const g=setTimeout(()=>{if(!document.querySelector(t.anchorSelector)||K.id)return;rt(t.id);const b=setTimeout(()=>{a.delete(t.id),M.id===t.id&&V(t.id)},2500);a.set(t.id,b)},t.triggerDelay??1e3);y.push(g)}}function p(){const e=i(f),n=B.filter(t=>t.trigger==="on-navigate"&&t.route===e&&it(t.id));for(const t of n){const g=setTimeout(()=>{if(!document.querySelector(t.anchorSelector)||K.id||M.id)return;rt(t.id);const b=setTimeout(()=>{a.delete(t.id),M.id===t.id&&V(t.id)},2e3);a.set(t.id,b)},t.triggerDelay??1500);y.push(g)}}dt(()=>{const e=Tt.url?.pathname??"/";e!==i(f)&&(u(f,e,!0),at(),m(),setTimeout(()=>{W(),p(),E()},300))});let s=U(()=>K.id?B.find(e=>e.id===K.id):void 0),h=U(()=>M.id?B.find(e=>e.id===M.id):void 0);function Z(){M.id&&V(M.id)}$(()=>{if(st.disabled)return;const e=["mousemove","mousedown","keydown","touchstart","scroll"];for(const n of e)document.addEventListener(n,v,{passive:!0});return()=>{for(const n of e)document.removeEventListener(n,v);m()}});var w=Y(),r=R(w);{var A=e=>{var n=Ct(),t=R(n);{var g=o=>{Nt(o,{get anchorSelector(){return i(h).anchorSelector},get position(){return i(h).position},onactivate:Z})};I(t,o=>{i(h)&&!i(s)&&o(g)})}var b=P(t,2);{var _=o=>{It(o,{get point(){return i(s)},ondismiss:()=>at()})};I(b,o=>{i(s)&&o(_)})}q(e,n)};I(r,e=>{st.disabled||e(A)})}q(j,w),et()}var Ht=C('<div class="drop-overlay svelte-12qhfyh"><div class="drop-content svelte-12qhfyh"><!> <span>释放以导入文件</span></div></div>'),Rt=C("<div> </div>"),Zt=C("<!> <!> <!>",1),Bt=C('<dialog class="confirm-dialog svelte-12qhfyh"><h3 class="svelte-12qhfyh">打开文件</h3> <p class="svelte-12qhfyh">当前编辑器有未保存的内容，打开新文件将替换当前内容。</p> <div class="dialog-actions svelte-12qhfyh"><button class="dialog-btn primary svelte-12qhfyh">替换</button> <button class="dialog-btn svelte-12qhfyh">取消</button></div></dialog>'),Xt=C('<div class="app svelte-12qhfyh"><main id="main-content" class="svelte-12qhfyh"><!></main> <!></div> <!>',1);function de(j,d){tt(d,!0);const y=()=>wt(Mt,"$page",l),[l,a]=bt();let f=U(()=>y().url.pathname.startsWith("/showcase")),m=H(!1),v=0,E;const W=[".md",".markdown",".txt",".zip"];function p(o){return!(!o.dataTransfer?.types.includes("Files")||o.dataTransfer.types.includes("application/x-presto-files"))}function s(o){p(o)&&(v++,o.preventDefault(),u(m,!0))}function h(o){p(o)&&(o.preventDefault(),o.stopPropagation())}function Z(o){p(o)&&(v--,v<=0&&(v=0,u(m,!1)))}async function w(o){if(v=0,u(m,!1),!p(o)||(o.preventDefault(),o.stopPropagation(),window.runtime?.EventsOn))return;const k=Array.from(o.dataTransfer.files).filter(T=>W.some(D=>T.name.toLowerCase().endsWith(D)));k.length!==0&&await N.processFiles(k,window.location.pathname)}dt(()=>{N.confirmVisible?E?.showModal():E?.close()}),$(()=>{if(!i(f))return window.addEventListener("dragenter",s,!0),window.addEventListener("dragover",h,!0),window.addEventListener("dragleave",Z,!0),window.addEventListener("drop",w,!0),window.runtime?.EventsOn&&window.runtime.EventsOn("native-file-drop",async(...o)=>{const k=Array.isArray(o[0])?o[0]:o;v=0,u(m,!1);const T=new Map,D=[],L=[];for(const c of k)if(c.isZip&&c.path)try{const F=await window.go.main.App.ImportBatchZip(c.path);L.push(F)}catch(F){console.error("ImportBatchZip failed:",F),N.showToast(F instanceof Error?F.message:"ZIP 导入失败","error")}else T.set(c.name,c.dir),D.push(new File([c.content],c.name,{type:"text/markdown"}));(D.length>0||L.length>0)&&N.processFiles(D,window.location.pathname,T.size>0?T:void 0,L.length>0?L:void 0)}),()=>{window.removeEventListener("dragenter",s,!0),window.removeEventListener("dragover",h,!0),window.removeEventListener("dragleave",Z,!0),window.removeEventListener("drop",w,!0)}});var r=Xt(),A=R(r),e=x(A),n=x(e);yt(n,()=>d.children),S(e);var t=P(e,2);{var g=o=>{var k=Zt(),T=R(k);Wt(T,{});var D=P(T,2);{var L=z=>{var O=Ht(),G=x(O),ot=x(G);Pt(ot,{size:32}),vt(2),S(G),S(O),q(z,O)};I(D,z=>{i(m)&&z(L)})}var c=P(D,2);{var F=z=>{var O=Rt();let G;var ot=x(O,!0);S(O),Q(()=>{G=ct(O,1,"toast svelte-12qhfyh",null,G,{"toast-error":N.toast.type==="error"}),J(ot,N.toast.message)}),q(z,O)};I(c,z=>{N.toast&&z(F)})}q(o,k)};I(t,o=>{i(f)||o(g)})}S(A);var b=P(A,2);{var _=o=>{var k=Bt(),T=P(x(k),4),D=x(T),L=P(D,2);S(T),S(k),ft(k,c=>E=c,()=>E),X("click",D,function(...c){N.confirmAccept?.apply(this,c)}),X("click",L,function(...c){N.confirmCancel?.apply(this,c)}),q(o,k)};I(b,o=>{i(f)||o(_)})}q(j,r),et(),a()}nt(["click"]);export{de as component,le as universal};
