import{c as Q,a as q,f as C}from"../chunks/C39mV9My.js";import{o as Y}from"../chunks/BN5aVeYL.js";import{f as H,p as tt,d as W,e as dt,b as u,g as i,a as et,c as T,s as M,r as x,t as V,u as J,H as ct,G as vt}from"../chunks/D1kjAdh8.js";import{d as nt,s as K,a as B}from"../chunks/Oi55ULqo.js";import{l as ht,s as gt,i as R,p as bt,a as wt,b as yt}from"../chunks/DHvLmY1O.js";import{s as _t}from"../chunks/-N3K3M2H.js";import{I as kt,s as St,a as ut,c as ft}from"../chunks/ThjiEXdU.js";import{b as mt}from"../chunks/CQL5r_eC.js";import{p as Tt}from"../chunks/BbYf9rDQ.js";import{t as pt,f as xt,c as Et,a as Dt}from"../chunks/DYyef2Au.js";import{d as qt,c as at,w as st,a as L,s as it,b as X,e as rt,f as $}from"../chunks/DElPTFiF.js";import"../chunks/BlPGaWXi.js";import{X as Lt}from"../chunks/KBWIkVsW.js";import{f as j}from"../chunks/DajPFPQ-.js";import{p as Mt}from"../chunks/tY5685WV.js";import{g as lt}from"../chunks/D-UU5hfZ.js";import{F as At}from"../chunks/BL--OL2S.js";const Pt=!0,Ft=!1,ce=Object.freeze(Object.defineProperty({__proto__:null,prerender:Pt,ssr:Ft},Symbol.toStringTag,{value:"Module"}));function zt(I,d){const _=ht(d,["children","$$slots","$$events","$$legacy"]);const l=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];kt(I,gt({name:"lightbulb"},()=>_,{get iconNode(){return l},children:(a,f)=>{var m=Q(),v=H(m);St(v,d,"default",{}),q(a,m)},$$slots:{default:!0}}))}var Ot=C('<div class="hint-shortcut svelte-1jumk7e"><kbd class="svelte-1jumk7e"> </kbd></div>'),Rt=C('<div role="tooltip" aria-live="polite"><div class="hint-header svelte-1jumk7e"><!> <span class="hint-title svelte-1jumk7e"> </span> <button class="hint-close svelte-1jumk7e" aria-label="关闭提示"><!></button></div> <p class="hint-body svelte-1jumk7e"> </p> <!> <button class="hint-dismiss svelte-1jumk7e">知道了</button></div>');function It(I,d){tt(d,!0);let _=W(void 0),l=W(dt({top:0,left:0})),a=W("top"),f=W(!1),m;function v(){const y=document.querySelector(d.point.anchorSelector);if(!y||!i(_))return;const r=y.getBoundingClientRect(),A=i(_).getBoundingClientRect(),o=A.width||280,n=A.height||120,t=12,b=window.innerWidth,w=window.innerHeight;let k=d.point.position;switch(k==="bottom"&&r.bottom+t+n>w&&(k="top"),k==="top"&&r.top-t-n<0&&(k="bottom"),k==="right"&&r.right+t+o>b&&(k="left"),k==="left"&&r.left-t-o<0&&(k="right"),k){case"bottom":u(l,{top:r.bottom+t,left:Math.max(8,Math.min(b-o-8,r.left+r.width/2-o/2))},!0),u(a,"top");break;case"top":u(l,{top:r.top-t-n,left:Math.max(8,Math.min(b-o-8,r.left+r.width/2-o/2))},!0),u(a,"bottom");break;case"right":u(l,{top:Math.max(8,Math.min(w-n-8,r.top+r.height/2-n/2)),left:r.right+t},!0),u(a,"left");break;case"left":u(l,{top:Math.max(8,Math.min(w-n-8,r.top+r.height/2-n/2)),left:r.left-t-o},!0),u(a,"right");break}}function E(){qt(d.point.id),d.ondismiss?.()}function N(y){y.key==="Escape"&&E()}Y(()=>{const y=setTimeout(()=>{u(f,!0),requestAnimationFrame(v)},50);function r(){i(f)&&v(),m=requestAnimationFrame(r)}return m=requestAnimationFrame(r),document.addEventListener("keydown",N),()=>{clearTimeout(y),cancelAnimationFrame(m),document.removeEventListener("keydown",N)}});const h=J(()=>({y:i(a)==="top"?-8:i(a)==="bottom"?8:0,x:i(a)==="left"?-8:i(a)==="right"?8:0,duration:300,easing:Et}));var s=Q(),g=H(s);{var U=y=>{var r=Rt();let A;var o=T(r),n=T(o);zt(n,{size:14});var t=M(n,2),b=T(t,!0);x(t);var w=M(t,2),k=T(w);Lt(k,{size:12}),x(w),x(o);var e=M(o,2),p=T(e,!0);x(e);var S=M(e,2);{var D=c=>{var P=Ot(),z=T(P),O=T(z,!0);x(z),x(P),V(()=>K(O,d.point.shortcut)),q(c,P)};R(S,c=>{d.point.shortcut&&c(D)})}var F=M(S,2);x(r),mt(r,c=>u(_,c),()=>i(_)),V(()=>{A=ut(r,1,"wizard-hint svelte-1jumk7e",null,A,{"arrow-top":i(a)==="top","arrow-bottom":i(a)==="bottom","arrow-left":i(a)==="left","arrow-right":i(a)==="right"}),ft(r,`top: ${i(l).top??""}px; left: ${i(l).left??""}px`),K(b,d.point.title),K(p,d.point.body)}),B("click",w,E),B("click",F,E),pt(3,r,()=>xt,()=>i(h)),q(y,r)};R(g,y=>{i(f)&&y(U)})}q(I,s),et()}nt(["click"]);var jt=C('<div class="wizard-nudge svelte-tnfk1q" role="button" tabindex="0" aria-label="提示可用，点击查看"><div class="nudge-dot svelte-tnfk1q"></div> <div class="nudge-ring svelte-tnfk1q"></div></div>');function Ct(I,d){tt(d,!0);let _=bt(d,"position",3,"right"),l=W(dt({top:0,left:0})),a=W(!1),f;function m(){const h=document.querySelector(d.anchorSelector);if(!h)return;const s=h.getBoundingClientRect(),g=12;switch(_()){case"top":u(l,{top:s.top-g,left:s.left+s.width/2},!0);break;case"bottom":u(l,{top:s.bottom+g,left:s.left+s.width/2},!0);break;case"left":u(l,{top:s.top+s.height/2,left:s.left-g},!0);break;case"right":u(l,{top:s.top+s.height/2,left:s.right+g},!0);break}}Y(()=>{const h=setTimeout(()=>{u(a,!0),m()},100);function s(){i(a)&&m(),f=requestAnimationFrame(s)}return f=requestAnimationFrame(s),()=>{clearTimeout(h),cancelAnimationFrame(f)}});var v=Q(),E=H(v);{var N=h=>{var s=jt();V(()=>ft(s,`top: ${i(l).top??""}px; left: ${i(l).left??""}px`)),B("click",s,function(...g){d.onactivate?.apply(this,g)}),B("keydown",s,g=>{g.key==="Enter"&&d.onactivate?.()}),pt(3,s,()=>Dt,()=>({duration:400})),q(h,s)};R(E,h=>{i(a)&&h(N)})}q(I,v),et()}nt(["click","keydown"]);const Z=[{id:"template-selector",trigger:"on-mount",anchorSelector:".template-select",position:"bottom",title:"选择模板",body:"在这里切换文档模板，不同模板适用于不同类型的文档。",route:"/",triggerDelay:1500},{id:"export-pdf",trigger:"on-mount",anchorSelector:".btn-export",position:"bottom",title:"导出 PDF",body:"编辑完成后，点击此按钮将文档导出为 PDF 文件。",shortcut:"⌘E",route:"/",triggerDelay:8e3},{id:"default-document",trigger:"on-mount",anchorSelector:".preview-container",position:"left",title:"模板示例",body:"右侧显示的是当前模板的示例文档。在左侧编辑器中输入你的 Markdown 内容，预览会实时更新。",route:"/",triggerDelay:15e3},{id:"shortcuts-overview",trigger:"on-mount",anchorSelector:".toolbar",position:"bottom",title:"常用快捷键",body:"熟悉这些快捷键可以大幅提升效率。",shortcut:"⌘O 打开 · ⌘E 导出 · ⌘F 查找 · ⌘Z 撤销",route:"/",triggerDelay:22e3},{id:"batch-mode",trigger:"on-idle",anchorSelector:".toolbar",position:"bottom",title:"批量转换",body:"需要一次转换多个文件？访问设置页面了解批量转换功能。",idleSeconds:120,route:"/"},{id:"image-path",trigger:"on-action",anchorSelector:".editor-container",position:"top",title:"图片路径",body:"使用 ![描述](路径) 插入图片。通过 ⌘O 打开文件后路径相对于文件目录，直接编辑时请使用绝对路径。",route:"/"},{id:"image-error",trigger:"on-action",anchorSelector:".error-msg",position:"bottom",title:"图片加载失败？",body:"请检查图片路径是否正确。通过 ⌘O 打开 .md 文件后，图片路径相对于文件所在目录；直接在编辑器中输入时，需要使用绝对路径。",route:"/"},{id:"settings-shortcut",trigger:"on-navigate",anchorSelector:".page-header",position:"bottom",title:"快速打开设置",body:"下次可以直接用快捷键打开设置页面。",shortcut:"⌘,",route:"/settings",triggerDelay:2e3},{id:"community-template-toggle",trigger:"on-action",anchorSelector:".nav-divider",position:"right",title:"模板管理已解锁",body:"侧栏新增了「模板管理」和「模板搜索」，点击即可浏览和安装第三方模板。",route:"/settings"}];var Nt=C("<!> <!>",1);function Wt(I,d){tt(d,!0);let _=[],l=new Map,a=new Map,f=W("");function m(){for(const o of _)clearTimeout(o);_=[];for(const o of l.values())clearTimeout(o);l.clear();for(const o of a.values())clearTimeout(o);a.clear()}function v(){if(L.id){const o=Z.find(n=>n.id===L.id);if(o?.trigger==="on-idle"){L.id=null;const n=a.get(o.id);n&&(clearTimeout(n),a.delete(o.id))}}for(const[o,n]of l)clearTimeout(n),l.delete(o);E()}function E(){const o=i(f),n=Z.filter(t=>t.trigger==="on-idle"&&t.route===o&&it(t.id));for(const t of n){if(l.has(t.id))continue;const b=setTimeout(()=>{if(l.delete(t.id),!document.querySelector(t.anchorSelector)||X.id||L.id)return;rt(t.id);const w=setTimeout(()=>{a.delete(t.id),L.id===t.id&&$(t.id)},3e3);a.set(t.id,w)},(t.idleSeconds??30)*1e3);l.set(t.id,b)}}function N(){const o=i(f),n=Z.filter(t=>t.trigger==="on-mount"&&t.route===o&&it(t.id)).sort((t,b)=>(t.triggerDelay??0)-(b.triggerDelay??0));for(const t of n){const b=setTimeout(()=>{if(!document.querySelector(t.anchorSelector)||X.id)return;rt(t.id);const w=setTimeout(()=>{a.delete(t.id),L.id===t.id&&$(t.id)},2500);a.set(t.id,w)},t.triggerDelay??1e3);_.push(b)}}function h(){const o=i(f),n=Z.filter(t=>t.trigger==="on-navigate"&&t.route===o&&it(t.id));for(const t of n){const b=setTimeout(()=>{if(!document.querySelector(t.anchorSelector)||X.id||L.id)return;rt(t.id);const w=setTimeout(()=>{a.delete(t.id),L.id===t.id&&$(t.id)},2e3);a.set(t.id,w)},t.triggerDelay??1500);_.push(b)}}ct(()=>{const o=Tt.url?.pathname??"/";o!==i(f)&&(u(f,o,!0),at(),m(),setTimeout(()=>{N(),h(),E()},300))});let s=J(()=>X.id?Z.find(o=>o.id===X.id):void 0),g=J(()=>L.id?Z.find(o=>o.id===L.id):void 0);function U(){L.id&&$(L.id)}Y(()=>{if(st.disabled)return;const o=["mousemove","mousedown","keydown","touchstart","scroll"];for(const n of o)document.addEventListener(n,v,{passive:!0});return()=>{for(const n of o)document.removeEventListener(n,v);m()}});var y=Q(),r=H(y);{var A=o=>{var n=Nt(),t=H(n);{var b=e=>{Ct(e,{get anchorSelector(){return i(g).anchorSelector},get position(){return i(g).position},onactivate:U})};R(t,e=>{i(g)&&!i(s)&&e(b)})}var w=M(t,2);{var k=e=>{It(e,{get point(){return i(s)},ondismiss:()=>at()})};R(w,e=>{i(s)&&e(k)})}q(o,n)};R(r,o=>{st.disabled||o(A)})}q(I,y),et()}var Ht=C('<div class="drop-overlay svelte-12qhfyh"><div class="drop-content svelte-12qhfyh"><!> <span>释放以导入文件</span></div></div>'),Ut=C("<div> </div>"),Zt=C("<!> <!> <!>",1),Bt=C('<dialog class="confirm-dialog svelte-12qhfyh"><h3 class="svelte-12qhfyh">打开文件</h3> <p class="svelte-12qhfyh">当前编辑器有未保存的内容，打开新文件将替换当前内容。</p> <div class="dialog-actions svelte-12qhfyh"><button class="dialog-btn primary svelte-12qhfyh">替换</button> <button class="dialog-btn svelte-12qhfyh">取消</button></div></dialog>'),Gt=C('<div class="app svelte-12qhfyh"><main id="main-content" class="svelte-12qhfyh"><!></main> <!></div> <!>',1);function ue(I,d){tt(d,!0);const _=()=>yt(Mt,"$page",l),[l,a]=wt();let f=J(()=>_().url.pathname.startsWith("/showcase")),m=W(!1),v=0,E;const N=[".md",".markdown",".txt",".zip"];function h(e){return!(!e.dataTransfer?.types.includes("Files")||e.dataTransfer.types.includes("application/x-presto-files"))}function s(e){h(e)&&(v++,e.preventDefault(),u(m,!0))}function g(e){h(e)&&(e.preventDefault(),e.stopPropagation())}function U(e){h(e)&&(v--,v<=0&&(v=0,u(m,!1)))}async function y(e){if(v=0,u(m,!1),!h(e)||(e.preventDefault(),e.stopPropagation(),window.runtime?.EventsOn))return;const p=Array.from(e.dataTransfer.files).filter(S=>N.some(D=>S.name.toLowerCase().endsWith(D)));p.length!==0&&await j.processFiles(p,window.location.pathname)}ct(()=>{j.confirmVisible?E?.showModal():E?.close()}),Y(async()=>{if(!i(f)){if(window.addEventListener("dragenter",s,!0),window.addEventListener("dragover",g,!0),window.addEventListener("dragleave",U,!0),window.addEventListener("drop",y,!0),window.runtime?.EventsOn){window.runtime.EventsOn("url-scheme-open-template",e=>{console.log("[url-scheme] hot start event received:",e),lt(`/store-templates?template=${encodeURIComponent(e)}`)});try{console.log("[url-scheme] checking for startup URL...");const e=await window.go.main.App.GetStartupURL();if(console.log("[url-scheme] startup URL:",e),e){const p=e.match(/^presto:\/\/install\/(.+)/);p&&(console.log("[url-scheme] navigating to template:",p[1]),lt(`/store-templates?template=${encodeURIComponent(p[1])}`))}}catch(e){console.error("[url-scheme] GetStartupURL failed:",e)}window.runtime.EventsOn("native-file-drop",async(...e)=>{const p=Array.isArray(e[0])?e[0]:e;v=0,u(m,!1);const S=new Map,D=[],F=[];for(const c of p)if(c.isZip&&c.path)try{const P=await window.go.main.App.ImportBatchZip(c.path);F.push(P)}catch(P){console.error("ImportBatchZip failed:",P),j.showToast(P instanceof Error?P.message:"ZIP 导入失败","error")}else S.set(c.name,c.dir),D.push(new File([c.content],c.name,{type:"text/markdown"}));(D.length>0||F.length>0)&&j.processFiles(D,window.location.pathname,S.size>0?S:void 0,F.length>0?F:void 0)})}return()=>{window.removeEventListener("dragenter",s,!0),window.removeEventListener("dragover",g,!0),window.removeEventListener("dragleave",U,!0),window.removeEventListener("drop",y,!0)}}});var r=Gt(),A=H(r),o=T(A),n=T(o);_t(n,()=>d.children),x(o);var t=M(o,2);{var b=e=>{var p=Zt(),S=H(p);Wt(S,{});var D=M(S,2);{var F=z=>{var O=Ht(),G=T(O),ot=T(G);At(ot,{size:32}),vt(2),x(G),x(O),q(z,O)};R(D,z=>{i(m)&&z(F)})}var c=M(D,2);{var P=z=>{var O=Ut();let G;var ot=T(O,!0);x(O),V(()=>{G=ut(O,1,"toast svelte-12qhfyh",null,G,{"toast-error":j.toast.type==="error"}),K(ot,j.toast.message)}),q(z,O)};R(c,z=>{j.toast&&z(P)})}q(e,p)};R(t,e=>{i(f)||e(b)})}x(A);var w=M(A,2);{var k=e=>{var p=Bt(),S=M(T(p),4),D=T(S),F=M(D,2);x(S),x(p),mt(p,c=>E=c,()=>E),B("click",D,function(...c){j.confirmAccept?.apply(this,c)}),B("click",F,function(...c){j.confirmCancel?.apply(this,c)}),q(e,p)};R(w,e=>{i(f)||e(k)})}q(I,r),et(),a()}nt(["click"]);export{ue as component,ce as universal};
