import{c as Y,a as q,f as N}from"../chunks/zz4pAW5t.js";import{o as $}from"../chunks/aHgiBJh1.js";import{f as R,p as tt,d as H,D as dt,b as u,g as i,a as et,c as E,s as M,r as T,t as Q,G as U,H as lt,F as vt}from"../chunks/DdHHCz2d.js";import{d as nt,s as J,a as X}from"../chunks/B1nNSMqB.js";import{l as pt,s as ht,i as C,p as gt,a as wt,b as bt}from"../chunks/BJJAIwca.js";import{s as yt}from"../chunks/CbQSkowS.js";import{I as _t,s as kt,a as ct,c as ut}from"../chunks/0vhbyHiM.js";import{b as ft}from"../chunks/BuQ4--zT.js";import{p as xt}from"../chunks/CEQEsSB3.js";import{t as mt,f as Et,d as Tt,c as St,b as Dt,e as at,w as st,g as A,s as it,h as K,i as rt,j as V}from"../chunks/CJmKLHke.js";import"../chunks/gMsrDP8M.js";import{X as qt}from"../chunks/Bx42O4zn.js";import{f as I}from"../chunks/D-Rx0OVB.js";import{p as At}from"../chunks/n2Ub9Dm0.js";import{F as Mt}from"../chunks/CK89AMs3.js";const Ot=!0,Pt=!1,se=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ot,ssr:Pt},Symbol.toStringTag,{value:"Module"}));function Ft(j,l){const y=pt(l,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];_t(j,ht({name:"lightbulb"},()=>y,{get iconNode(){return d},children:(a,f)=>{var m=Y(),v=R(m);kt(v,l,"default",{}),q(a,m)},$$slots:{default:!0}}))}var Lt=N('<div class="hint-shortcut svelte-1jumk7e"><kbd class="svelte-1jumk7e"> </kbd></div>'),zt=N('<div role="tooltip" aria-live="polite"><div class="hint-header svelte-1jumk7e"><!> <span class="hint-title svelte-1jumk7e"> </span> <button class="hint-close svelte-1jumk7e" aria-label="关闭提示"><!></button></div> <p class="hint-body svelte-1jumk7e"> </p> <!> <button class="hint-dismiss svelte-1jumk7e">知道了</button></div>');function Ct(j,l){tt(l,!0);let y=H(void 0),d=H(dt({top:0,left:0})),a=H("top"),f=H(!1),m;function v(){const b=document.querySelector(l.point.anchorSelector);if(!b||!i(y))return;const r=b.getBoundingClientRect(),O=i(y).getBoundingClientRect(),e=O.width||280,n=O.height||120,t=12,g=window.innerWidth,w=window.innerHeight;let _=l.point.position;switch(_==="bottom"&&r.bottom+t+n>w&&(_="top"),_==="top"&&r.top-t-n<0&&(_="bottom"),_==="right"&&r.right+t+e>g&&(_="left"),_==="left"&&r.left-t-e<0&&(_="right"),_){case"bottom":u(d,{top:r.bottom+t,left:Math.max(8,Math.min(g-e-8,r.left+r.width/2-e/2))},!0),u(a,"top");break;case"top":u(d,{top:r.top-t-n,left:Math.max(8,Math.min(g-e-8,r.left+r.width/2-e/2))},!0),u(a,"bottom");break;case"right":u(d,{top:Math.max(8,Math.min(w-n-8,r.top+r.height/2-n/2)),left:r.right+t},!0),u(a,"left");break;case"left":u(d,{top:Math.max(8,Math.min(w-n-8,r.top+r.height/2-n/2)),left:r.left-t-e},!0),u(a,"right");break}}function S(){Tt(l.point.id),l.ondismiss?.()}function W(b){b.key==="Escape"&&S()}$(()=>{const b=setTimeout(()=>{u(f,!0),requestAnimationFrame(v)},50);function r(){i(f)&&v(),m=requestAnimationFrame(r)}return m=requestAnimationFrame(r),document.addEventListener("keydown",W),()=>{clearTimeout(b),cancelAnimationFrame(m),document.removeEventListener("keydown",W)}});const p=U(()=>({y:i(a)==="top"?-8:i(a)==="bottom"?8:0,x:i(a)==="left"?-8:i(a)==="right"?8:0,duration:300,easing:St}));var s=Y(),h=R(s);{var Z=b=>{var r=zt();let O;var e=E(r),n=E(e);Ft(n,{size:14});var t=M(n,2),g=E(t,!0);T(t);var w=M(t,2),_=E(w);qt(_,{size:12}),T(w),T(e);var o=M(e,2),k=E(o,!0);T(o);var x=M(o,2);{var D=c=>{var P=Lt(),L=E(P),z=E(L,!0);T(L),T(P),Q(()=>J(z,l.point.shortcut)),q(c,P)};C(x,c=>{l.point.shortcut&&c(D)})}var F=M(x,2);T(r),ft(r,c=>u(y,c),()=>i(y)),Q(()=>{O=ct(r,1,"wizard-hint svelte-1jumk7e",null,O,{"arrow-top":i(a)==="top","arrow-bottom":i(a)==="bottom","arrow-left":i(a)==="left","arrow-right":i(a)==="right"}),ut(r,`top: ${i(d).top??""}px; left: ${i(d).left??""}px`),J(g,l.point.title),J(k,l.point.body)}),X("click",w,S),X("click",F,S),mt(3,r,()=>Et,()=>i(p)),q(b,r)};C(h,b=>{i(f)&&b(Z)})}q(j,s),et()}nt(["click"]);var jt=N('<div class="wizard-nudge svelte-tnfk1q" role="button" tabindex="0" aria-label="提示可用，点击查看"><div class="nudge-dot svelte-tnfk1q"></div> <div class="nudge-ring svelte-tnfk1q"></div></div>');function It(j,l){tt(l,!0);let y=gt(l,"position",3,"right"),d=H(dt({top:0,left:0})),a=H(!1),f;function m(){const p=document.querySelector(l.anchorSelector);if(!p)return;const s=p.getBoundingClientRect(),h=12;switch(y()){case"top":u(d,{top:s.top-h,left:s.left+s.width/2},!0);break;case"bottom":u(d,{top:s.bottom+h,left:s.left+s.width/2},!0);break;case"left":u(d,{top:s.top+s.height/2,left:s.left-h},!0);break;case"right":u(d,{top:s.top+s.height/2,left:s.right+h},!0);break}}$(()=>{const p=setTimeout(()=>{u(a,!0),m()},100);function s(){i(a)&&m(),f=requestAnimationFrame(s)}return f=requestAnimationFrame(s),()=>{clearTimeout(p),cancelAnimationFrame(f)}});var v=Y(),S=R(v);{var W=p=>{var s=jt();Q(()=>ut(s,`top: ${i(d).top??""}px; left: ${i(d).left??""}px`)),X("click",s,function(...h){l.onactivate?.apply(this,h)}),X("keydown",s,h=>{h.key==="Enter"&&l.onactivate?.()}),mt(3,s,()=>Dt,()=>({duration:400})),q(p,s)};C(S,p=>{i(a)&&p(W)})}q(j,v),et()}nt(["click","keydown"]);const B=[{id:"template-selector",trigger:"on-mount",anchorSelector:".template-select",position:"bottom",title:"选择模板",body:"在这里切换文档模板，不同模板适用于不同类型的文档。",route:"/",triggerDelay:1500},{id:"export-pdf",trigger:"on-mount",anchorSelector:".btn-export",position:"bottom",title:"导出 PDF",body:"编辑完成后，点击此按钮将文档导出为 PDF 文件。",shortcut:"⌘E",route:"/",triggerDelay:8e3},{id:"default-document",trigger:"on-mount",anchorSelector:".preview-container",position:"left",title:"模板示例",body:"右侧显示的是当前模板的示例文档。在左侧编辑器中输入你的 Markdown 内容，预览会实时更新。",route:"/",triggerDelay:15e3},{id:"shortcuts-overview",trigger:"on-mount",anchorSelector:".toolbar",position:"bottom",title:"常用快捷键",body:"熟悉这些快捷键可以大幅提升效率。",shortcut:"⌘O 打开 · ⌘E 导出 · ⌘F 查找 · ⌘Z 撤销",route:"/",triggerDelay:22e3},{id:"batch-mode",trigger:"on-idle",anchorSelector:".toolbar",position:"bottom",title:"批量转换",body:"需要一次转换多个文件？访问设置页面了解批量转换功能。",idleSeconds:120,route:"/"},{id:"image-path",trigger:"on-action",anchorSelector:".editor-container",position:"top",title:"图片路径",body:"使用 ![描述](路径) 插入图片。通过 ⌘O 打开文件后路径相对于文件目录，直接编辑时请使用绝对路径。",route:"/"},{id:"image-error",trigger:"on-action",anchorSelector:".error-msg",position:"bottom",title:"图片加载失败？",body:"请检查图片路径是否正确。通过 ⌘O 打开 .md 文件后，图片路径相对于文件所在目录；直接在编辑器中输入时，需要使用绝对路径。",route:"/"},{id:"settings-shortcut",trigger:"on-navigate",anchorSelector:".page-header",position:"bottom",title:"快速打开设置",body:"下次可以直接用快捷键打开设置页面。",shortcut:"⌘,",route:"/settings",triggerDelay:2e3},{id:"community-template-toggle",trigger:"on-action",anchorSelector:".nav-divider",position:"right",title:"模板管理已解锁",body:"侧栏新增了「模板管理」和「模板搜索」，点击即可浏览和安装第三方模板。",route:"/settings"}];var Nt=N("<!> <!>",1);function Wt(j,l){tt(l,!0);let y=[],d=new Map,a=new Map,f=H("");function m(){for(const e of y)clearTimeout(e);y=[];for(const e of d.values())clearTimeout(e);d.clear();for(const e of a.values())clearTimeout(e);a.clear()}function v(){if(A.id){const e=B.find(n=>n.id===A.id);if(e?.trigger==="on-idle"){A.id=null;const n=a.get(e.id);n&&(clearTimeout(n),a.delete(e.id))}}for(const[e,n]of d)clearTimeout(n),d.delete(e);S()}function S(){const e=i(f),n=B.filter(t=>t.trigger==="on-idle"&&t.route===e&&it(t.id));for(const t of n){if(d.has(t.id))continue;const g=setTimeout(()=>{if(d.delete(t.id),!document.querySelector(t.anchorSelector)||K.id||A.id)return;rt(t.id);const w=setTimeout(()=>{a.delete(t.id),A.id===t.id&&V(t.id)},3e3);a.set(t.id,w)},(t.idleSeconds??30)*1e3);d.set(t.id,g)}}function W(){const e=i(f),n=B.filter(t=>t.trigger==="on-mount"&&t.route===e&&it(t.id)).sort((t,g)=>(t.triggerDelay??0)-(g.triggerDelay??0));for(const t of n){const g=setTimeout(()=>{if(!document.querySelector(t.anchorSelector)||K.id)return;rt(t.id);const w=setTimeout(()=>{a.delete(t.id),A.id===t.id&&V(t.id)},2500);a.set(t.id,w)},t.triggerDelay??1e3);y.push(g)}}function p(){const e=i(f),n=B.filter(t=>t.trigger==="on-navigate"&&t.route===e&&it(t.id));for(const t of n){const g=setTimeout(()=>{if(!document.querySelector(t.anchorSelector)||K.id||A.id)return;rt(t.id);const w=setTimeout(()=>{a.delete(t.id),A.id===t.id&&V(t.id)},2e3);a.set(t.id,w)},t.triggerDelay??1500);y.push(g)}}lt(()=>{const e=xt.url?.pathname??"/";e!==i(f)&&(u(f,e,!0),at(),m(),setTimeout(()=>{W(),p(),S()},300))});let s=U(()=>K.id?B.find(e=>e.id===K.id):void 0),h=U(()=>A.id?B.find(e=>e.id===A.id):void 0);function Z(){A.id&&V(A.id)}$(()=>{if(st.disabled)return;const e=["mousemove","mousedown","keydown","touchstart","scroll"];for(const n of e)document.addEventListener(n,v,{passive:!0});return()=>{for(const n of e)document.removeEventListener(n,v);m()}});var b=Y(),r=R(b);{var O=e=>{var n=Nt(),t=R(n);{var g=o=>{It(o,{get anchorSelector(){return i(h).anchorSelector},get position(){return i(h).position},onactivate:Z})};C(t,o=>{i(h)&&!i(s)&&o(g)})}var w=M(t,2);{var _=o=>{Ct(o,{get point(){return i(s)},ondismiss:()=>at()})};C(w,o=>{i(s)&&o(_)})}q(e,n)};C(r,e=>{st.disabled||e(O)})}q(j,b),et()}var Ht=N('<div class="drop-overlay svelte-12qhfyh"><div class="drop-content svelte-12qhfyh"><!> <span>释放以导入文件</span></div></div>'),Rt=N("<div> </div>"),Zt=N("<!> <!> <!>",1),Bt=N('<dialog class="confirm-dialog svelte-12qhfyh"><h3 class="svelte-12qhfyh">打开文件</h3> <p class="svelte-12qhfyh">当前编辑器有未保存的内容，打开新文件将替换当前内容。</p> <div class="dialog-actions svelte-12qhfyh"><button class="dialog-btn primary svelte-12qhfyh">替换</button> <button class="dialog-btn svelte-12qhfyh">取消</button></div></dialog>'),Xt=N('<div class="app svelte-12qhfyh"><main id="main-content" class="svelte-12qhfyh"><!></main> <!></div> <!>',1);function de(j,l){tt(l,!0);const y=()=>bt(At,"$page",d),[d,a]=wt();let f=U(()=>y().url.pathname.startsWith("/showcase")),m=H(!1),v=0,S;const W=[".md",".markdown",".txt",".zip"];function p(o){return!(!o.dataTransfer?.types.includes("Files")||o.dataTransfer.types.includes("application/x-presto-files"))}function s(o){p(o)&&(v++,o.preventDefault(),u(m,!0))}function h(o){p(o)&&(o.preventDefault(),o.stopPropagation())}function Z(o){p(o)&&(v--,v<=0&&(v=0,u(m,!1)))}async function b(o){if(v=0,u(m,!1),!p(o)||(o.preventDefault(),o.stopPropagation(),window.runtime?.EventsOn))return;const k=Array.from(o.dataTransfer.files).filter(x=>W.some(D=>x.name.toLowerCase().endsWith(D)));k.length!==0&&await I.processFiles(k,window.location.pathname)}lt(()=>{I.confirmVisible?S?.showModal():S?.close()}),$(()=>{if(!i(f))return window.addEventListener("dragenter",s,!0),window.addEventListener("dragover",h,!0),window.addEventListener("dragleave",Z,!0),window.addEventListener("drop",b,!0),window.runtime?.EventsOn&&(window.runtime.EventsOn("menu:undo",()=>document.execCommand("undo")),window.runtime.EventsOn("menu:redo",()=>document.execCommand("redo")),window.runtime.EventsOn("menu:cut",()=>document.execCommand("cut")),window.runtime.EventsOn("menu:copy",()=>document.execCommand("copy")),window.runtime.EventsOn("menu:paste",()=>document.execCommand("paste")),window.runtime.EventsOn("menu:selectAll",()=>document.execCommand("selectAll")),window.runtime.EventsOn("native-file-drop",async(...o)=>{const k=Array.isArray(o[0])?o[0]:o;v=0,u(m,!1);const x=new Map,D=[],F=[];for(const c of k)if(c.isZip&&c.path)try{const P=await window.go.main.App.ImportBatchZip(c.path);F.push(P)}catch(P){console.error("ImportBatchZip failed:",P),I.showToast(P instanceof Error?P.message:"ZIP 导入失败","error")}else x.set(c.name,c.dir),D.push(new File([c.content],c.name,{type:"text/markdown"}));(D.length>0||F.length>0)&&I.processFiles(D,window.location.pathname,x.size>0?x:void 0,F.length>0?F:void 0)})),()=>{window.removeEventListener("dragenter",s,!0),window.removeEventListener("dragover",h,!0),window.removeEventListener("dragleave",Z,!0),window.removeEventListener("drop",b,!0)}});var r=Xt(),O=R(r),e=E(O),n=E(e);yt(n,()=>l.children),T(e);var t=M(e,2);{var g=o=>{var k=Zt(),x=R(k);Wt(x,{});var D=M(x,2);{var F=L=>{var z=Ht(),G=E(z),ot=E(G);Mt(ot,{size:32}),vt(2),T(G),T(z),q(L,z)};C(D,L=>{i(m)&&L(F)})}var c=M(D,2);{var P=L=>{var z=Rt();let G;var ot=E(z,!0);T(z),Q(()=>{G=ct(z,1,"toast svelte-12qhfyh",null,G,{"toast-error":I.toast.type==="error"}),J(ot,I.toast.message)}),q(L,z)};C(c,L=>{I.toast&&L(P)})}q(o,k)};C(t,o=>{i(f)||o(g)})}T(O);var w=M(O,2);{var _=o=>{var k=Bt(),x=M(E(k),4),D=E(x),F=M(D,2);T(x),T(k),ft(k,c=>S=c,()=>S),X("click",D,function(...c){I.confirmAccept?.apply(this,c)}),X("click",F,function(...c){I.confirmCancel?.apply(this,c)}),q(o,k)};C(w,o=>{i(f)||o(_)})}q(j,r),et(),a()}nt(["click"]);export{de as component,se as universal};
