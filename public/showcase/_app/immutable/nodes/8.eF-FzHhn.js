import{a as M,f as B}from"../chunks/zz4pAW5t.js";import{a as Te}from"../chunks/aHgiBJh1.js";import{p as De,d as l,D as Ee,H as Se,g as s,f as Fe,t as W,a as ze,G as Le,b as t,c as o,s as n,r as i,F as Ae}from"../chunks/DdHHCz2d.js";import{d as Me,a as $,e as Z,s as ee}from"../chunks/B1nNSMqB.js";import{i as N,a as Ne,b as Be}from"../chunks/BJJAIwca.js";import{a as te,c as se,b as Ie}from"../chunks/0vhbyHiM.js";import{b as ae}from"../chunks/BuQ4--zT.js";import{p as Ce}from"../chunks/n2Ub9Dm0.js";import{E as Ge,p as Xe}from"../chunks/CTon4bOM.js";import{P as Ye}from"../chunks/DAvGkWzf.js";import{j as Oe,g as Ue}from"../chunks/D-SIh8RA.js";import{g as Ve}from"../chunks/Bm8zFn3A.js";import{g as He}from"../chunks/DrTtjm8K.js";import{j as qe}from"../chunks/D6u2LCMp.js";import{S as Je}from"../chunks/Bku8nPrm.js";import{F as Ke,L as Qe}from"../chunks/B1HYaQJY.js";import{D as We}from"../chunks/RJDjesxt.js";import{L as Ze}from"../chunks/CMkOTgKf.js";var et=B('<div class="status-dot svelte-j6xk7s"></div>'),tt=B('<span class="error-msg svelte-j6xk7s"> </span>'),st=B('<div class="toolbar svelte-j6xk7s"><div class="toolbar-left svelte-j6xk7s"><span class="template-name svelte-j6xk7s"><!> </span> <!></div> <div class="toolbar-right svelte-j6xk7s"><!> <div><button class="btn-toolbar svelte-j6xk7s" aria-label="设置"><!></button> <button class="btn-toolbar svelte-j6xk7s" aria-label="打开文件"><!></button> <button class="btn-toolbar svelte-j6xk7s" aria-label="批量转换"><!></button></div> <button class="btn-export svelte-j6xk7s" aria-label="导出 PDF"><!> <span class="svelte-j6xk7s">导出 PDF</span></button></div></div> <div><div class="pane svelte-j6xk7s"><!></div> <div class="divider svelte-j6xk7s" role="separator" aria-label="拖动调整宽度" aria-orientation="vertical"><div class="divider-grip svelte-j6xk7s"><span class="svelte-j6xk7s"></span><span class="svelte-j6xk7s"></span><span class="svelte-j6xk7s"></span></div></div> <div class="pane svelte-j6xk7s"><!></div></div>',1);function jt(re,oe){De(oe,!0);const ie=()=>Be(Ce,"$page",le),[le,ne]=Ne(),ve={gongwen:{example:Ue,svgs:[Ve,He],displayName:"类公文模板"},"jiaoan-shicao":{example:Oe,svgs:[qe],displayName:"实操教案模板"}};let I=Le(()=>ie().url.searchParams.get("registry")||"gongwen"),b=l(""),_=l(Ee([])),m=l(""),u=l(!1),d=l("");const T="https://raw.githubusercontent.com/Presto-io/template-registry/main/templates";async function pe(e){t(u,!0),t(d,"");const a=ve[e];if(a){t(b,a.example,!0),t(_,a.svgs,!0),t(m,a.displayName,!0),t(u,!1);return}try{const[r,A]=await Promise.all([fetch(`${T}/${e}/example.md`),fetch(`${T}/${e}/manifest.json`)]);if(!r.ok)throw new Error(`模板 "${e}" 未找到`);if(t(b,await r.text(),!0),A.ok){const c=await A.json();t(m,c.displayName||c.name||e,!0)}else t(m,e,!0);const K=[];for(let c=1;c<=5;c++)try{const Q=await fetch(`${T}/${e}/preview-${c}.svg`);if(!Q.ok)break;const $e=await Q.text();K.push(Xe.sanitize($e,{USE_PROFILES:{svg:!0,svgFilters:!0},ADD_TAGS:["use"],ADD_ATTR:["xlink:href","clip-path","fill-rule","transform"]}))}catch{break}t(_,K,!0)}catch(r){t(d,r instanceof Error?r.message:String(r),!0),t(b,""),t(_,[],!0),t(m,e,!0)}finally{t(u,!1)}}Se(()=>{pe(s(I))});let C=l(0),G=l(0),v=l(null),D=l(.5),x=l(!1),h,j,f=l(!1),p;function X(){clearTimeout(p),t(f,!0)}function ce(){clearTimeout(p),p=setTimeout(()=>{t(f,!1)},800)}function me(e){if(!j)return;const a=j.getBoundingClientRect(),r=60;e.clientX>=a.left-r&&e.clientX<=a.right+r&&e.clientY>=a.top-r&&e.clientY<=a.bottom+r?X():s(f)&&(clearTimeout(p),p=setTimeout(()=>{t(f,!1)},800))}Te(()=>{clearTimeout(p)});function ue(e){t(x,!0),e.target.setPointerCapture(e.pointerId)}function de(e){if(!s(x)||!h)return;const a=h.getBoundingClientRect(),r=(e.clientX-a.left)/a.width;t(D,Math.min(.8,Math.max(.2,r)),!0)}function fe(){t(x,!1)}var Y=st(),k=Fe(Y),E=o(k),S=o(E),O=o(S);{var ge=e=>{Ze(e,{size:12,class:"spin"})};N(O,e=>{s(u)&&e(ge)})}var be=n(O);i(S);var _e=n(S,2);{var xe=e=>{var a=et();M(e,a)};N(_e,e=>{s(u)&&e(xe)})}i(E);var g=n(E,2),U=o(g);{var he=e=>{var a=tt(),r=o(a,!0);i(a),W(()=>{Ie(a,"title",s(d)),ee(r,s(d))}),M(e,a)};N(U,e=>{s(d)&&e(he)})}var w=n(U,2);let V;var F=o(w),je=o(F);Je(je,{size:14}),i(F);var z=n(F,2),ke=o(z);Ke(ke,{size:14}),i(z);var H=n(z,2),we=o(H);Qe(we,{size:14}),i(H),i(w);var q=n(w,2),ye=o(q);We(ye,{size:14}),Ae(2),i(q),i(g),ae(g,e=>j=e,()=>j),i(k);var y=n(k,2);let J;var R=o(y),Re=o(R);Ge(Re,{get value(){return s(b)},readOnly:!0,get scrollRatio(){return s(C)},onscroll:e=>{s(v)!=="preview"&&(t(v,"editor"),t(G,e,!0),setTimeout(()=>{t(v,null)},100))}}),i(R);var P=n(R,2),L=n(P,2),Pe=o(L);Ye(Pe,{get svgPages(){return s(_)},get scrollRatio(){return s(G)},onscroll:e=>{s(v)!=="editor"&&(t(v,"preview"),t(C,e,!0),setTimeout(()=>{t(v,null)},100))}}),i(L),i(y),ae(y,e=>h=e,()=>h),W(()=>{ee(be,` ${(s(m)||s(I))??""}`),V=te(w,1,"toolbar-hidden-group svelte-j6xk7s",null,V,{visible:s(f)}),J=te(y,1,"editor-layout svelte-j6xk7s",null,J,{dragging:s(x)}),se(R,`flex: ${s(D)??""}`),se(L,`flex: ${1-s(D)}`)}),$("mousemove",k,me),Z("mouseenter",g,X),Z("mouseleave",g,ce),$("pointerdown",P,ue),$("pointermove",P,de),$("pointerup",P,fe),M(re,Y),ze(),ne()}Me(["mousemove","pointerdown","pointermove","pointerup"]);export{jt as component};
