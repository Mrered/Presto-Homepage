import{d as m,D as w,g as p,b as d}from"./DdHHCz2d.js";const r="";function h(){return typeof document>"u"?"":document.querySelector('meta[name="api-key"]')?.getAttribute("content")||""}function s(a,e){const t=h();if(t){const o=new Headers(e?.headers);return o.set("Authorization",`Bearer ${t}`),fetch(a,{...e,headers:o})}return fetch(a,e)}async function u(a,e){const t=await s(`${r}${a}`,e);if(!t.ok)throw new Error(`API error: ${t.status}`);return t.json()}async function $(){return u("/api/templates")}async function g(){return u("/api/templates/discover")}async function E(a){return(await u(`/api/templates/${a}/example`)).example}async function S(a,e){const t=await s(`${r}/api/convert`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdown:a,templateId:e})});if(!t.ok){const n=await t.text();throw new Error(`Convert failed (${t.status}): ${n}`)}return(await t.json()).typst}async function j(a,e){const t={"Content-Type":"text/plain"};e&&(t["X-Work-Dir"]=e);const o=e?`${r}/api/compile-svg?workDir=${encodeURIComponent(e)}`:`${r}/api/compile-svg`,n=await s(o,{method:"POST",headers:t,body:a});if(!n.ok){const c=await n.text();throw new Error(`SVG compile failed (${n.status}): ${c}`)}return(await n.json()).pages}async function C(a,e,t){const o=await s(`${r}/api/convert-and-compile`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdown:a,templateId:e,workDir:t})});if(!o.ok){const n=await o.text();throw new Error(`Compile failed (${o.status}): ${n}`)}return o.blob()}async function v(a,e){const t=await s(`${r}/api/templates/${encodeURIComponent(a+"/"+e)}/install`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner:a,repo:e})});if(!t.ok)throw new Error(`Install failed: ${t.status}`)}async function P(a){const e=await s(`${r}/api/templates/${a}`,{method:"DELETE"});if(!e.ok)throw new Error(`Delete failed: ${e.status}`)}async function k(a,e){const t=await s(`${r}/api/templates/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:e})});if(!t.ok){const o=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(o.error||`Rename failed: ${t.status}`)}}async function O(a,e){const t=new FormData;t.append("file",a);const o=e?`?onConflict=${e}`:"",n=await s(`${r}/api/templates/import${o}`,{method:"POST",body:t});if(n.status===409){const i=await n.json(),c=new Error(i.error||"conflict");throw c.conflicts=i.conflicts,c}if(!n.ok){const i=await n.json().catch(()=>({error:`HTTP ${n.status}`}));throw new Error(i.error||`Import failed: ${n.status}`)}return n.json()}async function x(a){const e=new FormData;e.append("file",a);const t=await s(`${r}/api/batch/import-zip`,{method:"POST",body:e});if(!t.ok){const o=await t.json().catch(()=>({error:`HTTP ${t.status}`}));throw new Error(o.error||`Batch import failed: ${t.status}`)}return t.json()}let y=m(w([])),l=m(!1),f=m(!1);const T={get templates(){return p(y)},get loading(){return p(l)},get loaded(){return p(f)},async load(a=!1){if(!(p(f)&&!a)){d(l,!0);try{d(y,await $()??[],!0)}catch{}finally{d(l,!1),d(f,!0)}}},async refresh(){return this.load(!0)}};typeof window<"u"&&window.addEventListener("templates-changed",()=>{T.refresh()});export{j as a,C as b,S as c,O as d,P as e,g as f,E as g,v as h,x as i,$ as l,k as r,T as t};
