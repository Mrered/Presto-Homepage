---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
---
<Layout title="模板商店 - Presto">
  <Header />
  <main class="store-page">
    <iframe
      src="/showcase/store-templates"
      class="store-iframe"
      title="模板商店"
      sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"
      loading="eager"
    ></iframe>
    <script>
      window.addEventListener('message', (e) => {
        if (e.data?.type === 'presto-open-template' && e.data.url) {
          window.location.href = e.data.url;
        }
        if (e.data?.type === 'presto-resize' && e.data.height > 0) {
          const mq = window.matchMedia('(max-width: 768px)');
          if (!mq.matches) return;
          const iframe = document.querySelector('.store-iframe') as HTMLIFrameElement;
          if (iframe) iframe.style.minHeight = e.data.height + 'px';
        }
      });
    </script>
  </main>
  <Footer />
</Layout>

<style>
  .store-page {
    padding-top: calc(var(--header-height) + 1rem);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .store-iframe {
    flex: 1;
    width: 100%;
    max-width: 100vw;
    border: none;
    min-height: 600px;
  }
  @media (max-width: 768px) {
    .store-page {
      padding-top: calc(var(--header-height-mobile) + 0.5rem);
      min-height: 100dvh;
      height: auto;
      overflow: visible;
    }
    .store-iframe {
      min-height: 0;
    }
  }
</style>
